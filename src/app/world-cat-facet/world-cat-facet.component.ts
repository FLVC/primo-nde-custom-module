import { Component, ElementRef, inject, Inject, Input, OnInit, Renderer2 } from '@angular/core';
import { MatDividerModule } from '@angular/material/divider';
import { Store } from '@ngrx/store';
import { selectSearchParams } from '../primo-store.service';
import { Observable } from 'rxjs';

@Component({
  selector: 'custom-world-cat-facet',
  standalone: true,
  imports: [MatDividerModule],
  templateUrl: './world-cat-facet.component.html',
  styleUrl: './world-cat-facet.component.scss'
})

export class WorldCatFacetComponent implements OnInit {

  targetName: string = "WORLDCAT";
  targetUrl: string = "https://www.worldcat.org/search?qt=search_items&search=Search&q=";
  targetImg: string = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjAAAAIgCAMAAACs+aPGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxMDA0MjNGOTUzQ0YxMUU0QjE2M0ZDMzJCNjQ3NUE0MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxMDA0MjNGQTUzQ0YxMUU0QjE2M0ZDMzJCNjQ3NUE0MyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEwMDQyM0Y3NTNDRjExRTRCMTYzRkMzMkI2NDc1QTQzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjEwMDQyM0Y4NTNDRjExRTRCMTYzRkMzMkI2NDc1QTQzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+3mYWoQAAAwBQTFRF9owyy8PcdazR/erbq83j3KrE+KJZ/NSxY0uWx3ih/ePN7erzy+TLI3u2qjNxRJ1C4/DjsUR99fn8SpPD4bfNw7rX+fb5rNSrjMOLi3mxmMHd+Ktq2unztNLm6szc1OXx0pS19fn15sLVXKla9pI8m4y8hnSu4e31+8ui0svh+fj7TaJLe7p5bLJqhLXWalSb/Pj6PIq+/N3D+bJ1ZK5i+Pr8MoS77dPh95tN+sKStEqBjLrZ+r2K+bmD+9GtxeHE3e3d9oktc7Zy/ebSnMubvt29u1qM+bV7aaXNvmKS//r29pVB8Nzn+fH19vT5/u7hvbPT2dPlU6VR9OXtWpzI/vXu5eHtxXKd1py6zomtrqLIo5XB/Nq97fXt4dzr7fT5+fz5Qo3A//z6fLDT955TY6HL1OnTpcnh9YQl473R8vny/fz96vTqqZzFk77b/Pv8tarN2qXAx93sw26akoG1zIWq+KllrTh1zOHu3tnpudq4/P3+g76Byt/twd/Bttm18uDqLYG5/vDludXowdrqeWWlk8aR8Pf6sqbL6eXwpZjD9Ycp9YMi//78+O7zVpnHuVWJ/P38+8iddmGjo8+i6vL4UZbFc16h+vz9KH64/vLogW6qfmqolsiVvtjq+sWYloa42KG9QJs+9urwrz9537HJwWmX7NDetlCF8Pfw/vfw5vD3ptClcFuf8vD21tDj+86n+KZf+sCO0ObQocfgfGin8O31/vjyyn+msteyhsCF79jkua/Q2+za9+zx2evZcLRuUKNOr9Wuf7x+4O/gZk+Y0I6wnpC+X6tdwGaU/ejWbVidbafPebl3/f79/v7+SaBHP5o9/f7+/v3+mMmX58bX9PL3WKhX/Ne3OIe9+a9v/ODGV6dV5/LnuFOHj360j8SOvF+P3Nfodrd1z+Pvt6zP+vT3icKIqNGo6PPo9o83vNy7n8Xf9YQj1+rWmIi69efuX5/K/vTr9OTsxNvr3q/HoM2f95hG6PH3carQqTBv9YIgIHm1Ppo8YEiU////J8M4zgAAAQB0Uk5T////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AFP3ByUAACrLSURBVHja7J15nI5V/8dvRWYwM5YZouxmbGFoQpZQSmMb/LLTDEb2JlmmjLWizBiEslbSEKrHFokSaiRlKTtlSVH0ZCl5urfzG7RpDPc51+ds13U+r9fz9N+c65z77Zzv+W7HRYyMKOQyS2BkgDEywGihpPxPV84V8USX1E/PDi0eFTVv3uqZM9+pUSPTn12ZNa5o5syZq+fNi4qKGjp0aGRkZGpqapcuXT74ICIiV65ly57Ov9MAY0Pte7RyxBOp86PG1/CjFTR96PffDjDA2EI787eN6BJZfHymn7Myz1ZOMsBoTcqyNqlHpwf5xenzF/YZYHRU/spPRM7L9EtQZuo+A4xW9uyjEV2jpKDy1y7TZqcBRg9NjOg6L8gvX3M7GGBUV5VlXYrX8KuizAgDjMIqWnlQVJBfLXVNMcAoqZRvX1AOlis6WsUAo5zWRMyv4VdVxasYYJRShxfm+pVW8SQDjDJqO2i6X3mdNcCooacHzfRroRcMMAqcRF3G+7VRWwOM5At0xFy/TppZ1AAj03CJzPRrplQDjCy1/mC8X0M9bYCRooldM/1aKsoAI0GVj/q11TIDjGANiBjv11hRBhihqtJmpl9vPWpbYAqXfrXkuz/lzv3qnfcoc43+/nO/7upqS2BKl+hd0/u3an7x7p0K7C42wMXvr5FkO2BK96rtza6D1eUyMyBipt8WqmwvYFJyF/HmpJdzz5LGS67xfpso1U7ApPSp6b2RDv4kB5lv5/pto/E2Aua7It6bqeaz4ie7JtJvJ7W2CzD39PIGoofjxU416ftMW/EiJ2bNAZg7e3gDU+3nhLp1x/ttpjb2AObV2d6AVULcaTTfbzsNsgUwfUK8FLpFUNVERA378eKPtAMwJbx0+kIEMfmL++2oozYApo+XVr8L2F4ybcmLnPgjFphnQ6iB8dbnPMP/HPX7DTBqAnPnbC+DSvK9HH1uV178xXUHpnAPFl68sznGlpJS/fbVUN2B6eVlUxFuhu/EuTbmRftb0pNe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";
  targetAlt: string = "WORLDCAT";
  targetQuery: string = "";

  @Input() private hostComponent!: any;
  private searchParams$: Observable<any> | undefined;
  private store = inject(Store);

  constructor(
    private elementRef: ElementRef,
    private renderer: Renderer2,
		@Inject('MODULE_PARAMETERS') public moduleParameters: any,
	) { }

  ngOnInit(): void {
    const enabled = this.moduleParameters.worldcatEnabled === "true";

    if (!enabled) {
      return;
    }

    this.searchParams$ = this.store.select(selectSearchParams); 	//only works when search performed
    this.searchParams$.subscribe((searchParams) => {
      if (searchParams) {
        const query = searchParams.q ?? null;
        const mode = searchParams.mode ?? null;
        if (query) {
          if (mode && mode == "advanced") {
            const queryArray: string[] = query.split(';');
            try {
              this.targetQuery = encodeURIComponent(queryArray.map(function (part) {
                return part.split(",")[2] || "";
              }).join(' '));
            } catch (e) {
              this.targetQuery = "";
            }
          }
          else {
            this.targetQuery = encodeURIComponent(query);
          }
          setTimeout(() => {
            const targetDiv = this.findClosestTargetInHost();

            if (targetDiv) {
              const currentElement = this.elementRef.nativeElement;

              while (currentElement.firstChild) {
                this.renderer.appendChild(targetDiv, currentElement.firstChild);
              }
            }
          }, 0);
        }
      }
    });
  }

  private findClosestTargetInHost(): HTMLElement | null {
    let current: HTMLElement | null = this.elementRef.nativeElement.parentElement;

    while (current && current !== document.body) {
      if (current.classList.contains('scroller-content')) {
        return current;
      }

      const found = current.querySelector('.scroller-content');
      if (found) {
        return found as HTMLElement;
      }

      current = current.parentElement;
    }

    return null;
  }
}